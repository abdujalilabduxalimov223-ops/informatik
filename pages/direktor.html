<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Direktor paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="header">
  <div class="logo">ğŸ“ Direktor paneli</div>
  <nav class="nav">
    <a href="../index.html">Bosh sahifa</a>
    <a href="admin/dashboard.html">Dashboard</a>
  </nav>
</header>

<!-- ===== PAGE TITLE ===== -->
<section class="page-title">
  <h1>Oâ€˜qituvchilarni boshqarish</h1>
  <p>Login â€¢ Parol â€¢ Faollik nazorati</p>
</section>

<!-- ===== STATISTICS ===== -->
<section class="edu-section">
  <div class="edu-block">
    <h2>ğŸ“Š Umumiy statistika</h2>

    <div class="edu-cards">
      <div class="edu-card">
        <h3 id="totalUsers">0</h3>
        <p>Jami oâ€˜qituvchi</p>
      </div>

      <div class="edu-card">
        <h3 id="activeUsers">0</h3>
        <p>Hozir tizimda</p>
      </div>
    </div>
  </div>
</section>

<!-- ===== ADD TEACHER ===== -->
<section class="edu-section">
  <div class="edu-block">
    <h2>â• Oâ€˜qituvchi qoâ€˜shish</h2>

    <input class="input" id="newLogin" placeholder="Login">
    <input class="input" id="newPassword" placeholder="Parol">

    <button class="btn-primary" onclick="addUser()">Qoâ€˜shish</button>
  </div>
</section>

<!-- ===== USERS LIST ===== -->
<section class="edu-section">
  <div class="edu-block">
    <h2>ğŸ‘¥ Oâ€˜qituvchilar roâ€˜yxati</h2>

    <div id="usersList" class="edu-cards"></div>
  </div>
</section>

<script>
const API = "https://for-c8pq.onrender.com/api/teachers";

async function loadUsers() {
  try {
    const res = await fetch(API);
    const users = await res.json();

    document.getElementById("totalUsers").innerText = users.length;
    document.getElementById("activeUsers").innerText =
      users.filter(u => u.active).length;

    const list = document.getElementById("usersList");
    list.innerHTML = "";

    users.forEach(u => {
      list.innerHTML += `
        <div class="edu-card">
          <h3>ğŸ‘¤ ${u.login}</h3>

          <p>
            ğŸ”‘ <b>Parol:</b>
            <span style="font-family:monospace;background:#eee;padding:2px 6px;border-radius:6px;">
              ${u.password}
            </span>
          </p>

          <p>
            ğŸ“¡ Holati:
            ${u.active ? "ğŸŸ¢ Online" : "âšª Offline"}
          </p>

          <p>
            â± Oxirgi kirish:
            ${u.lastLogin ? new Date(u.lastLogin).toLocaleString() : "â€”"}
          </p>

          <div style="margin-top:10px;display:flex;gap:10px;">
            <button class="btn-secondary" onclick="resetPassword(${u.id})">
              â™» Parolni yangilash
            </button>

            <button class="btn-danger" onclick="removeUser(${u.id})">
              âŒ Oâ€˜chirish
            </button>
          </div>
        </div>
      `;
    });

  } catch (e) {
    console.error(e);
    alert("Oâ€˜qituvchilarni yuklashda xatolik");
  }
}

// ================= ADD USER =================
async function addUser() {
  const login = document.getElementById("newLogin").value.trim();
  const password = document.getElementById("newPassword").value.trim();

  if (!login || !password) {
    alert("Login va parol kiriting");
    return;
  }

  try {
    await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ login, password })
    });

    document.getElementById("newLogin").value = "";
    document.getElementById("newPassword").value = "";

    loadUsers();
  } catch (e) {
    console.error(e);
    alert("Oâ€˜qituvchi qoâ€˜shilmadi");
  }
}

// ================= DELETE =================
async function removeUser(id) {
  if (!confirm("Oâ€˜qituvchi oâ€˜chirilsinmi?")) return;

  try {
    await fetch(API + "/" + id, { method: "DELETE" });
    loadUsers();
  } catch (e) {
    console.error(e);
    alert("Oâ€˜chirishda xatolik");
  }
}

// ================= RESET PASSWORD =================
async function resetPassword(id) {
  const newPass = prompt("Yangi parolni kiriting:");
  if (!newPass) return;

  try {
    const res = await fetch(API + "/reset/" + id, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ password: newPass })
    });

    if (!res.ok) {
      const err = await res.text();
      alert("Xatolik: " + err);
      return;
    }

    alert("Parol muvaffaqiyatli yangilandi âœ…");
    loadUsers();

  } catch (e) {
    console.error(e);
    alert("Server bilan aloqa yoâ€˜q");
  }
}

// ================= INIT =================
loadUsers();
</script>




</body>
</html>
